- block:
    - name: Checking command '/usr/bin/atom'
      stat:
        path: /usr/bin/atom
      changed_when: false
      register: st
      failed_when: st.stat.exists == False
  rescue:
    - name: Installing nodejs
      become: yes
      apt:
        name: nodejs
    - name: Installing atom
      become: yes
      apt:
        deb: https://atom.io/download/deb
      register: install
      until: install is succeeded
      retries: 99
      delay: 3

- name: Installing atom plugins
  command: "/usr/bin/apm install {{ item }}"
  changed_when: false
  with_items:
    - autocomplete-ansible
    - ansible-vault
    - git-plus
    - platformio-ide-terminal
    - language-docker
    - language-ansible
    - atom-jinja2
  register: plugins
  until: plugins is succeeded
  retries: 99
  delay: 3
